# vos-fastpath — OpenSIPS 3.4+ with UDP listener (AF_XDP optional)
# Minimal config: REGISTER → save location + 200 OK; OPTIONS/others acknowledged.

listen = udp:0.0.0.0:5060

# ----- Modules -----
loadmodule "usrloc.so"
loadmodule "registrar.so"
loadmodule "signaling.so"
loadmodule "sl.so"
loadmodule "rr.so"
loadmodule "maxfwd.so"

# usrloc: in-memory only (no DB), domain "location"
modparam("usrloc", "working_mode_preset", "single-instance-no-db")
modparam("usrloc", "use_domain", 0)

# registrar: default expires for REGISTER
modparam("registrar", "default_expires", 3600)

# ----- Routing -----
request_route {
    if (!mf_process_maxfwd_header(10)) {
        send_reply(483, "Too Many Hops");
        exit;
    }
    if (is_method("REGISTER")) {
        if (!save("location")) {
            send_reply(500, "Registration failed");
            exit;
        }
        exit;
    }
    if (is_method("OPTIONS")) {
        send_reply(200, "OK");
        exit;
    }
    # INVITE, SUBSCRIBE, etc.: reply 200 or 404 for minimal setup
    if (is_method("INVITE|SUBSCRIBE|NOTIFY")) {
        send_reply(404, "Not Found");
        exit;
    }
    send_reply(405, "Method Not Allowed");
}
