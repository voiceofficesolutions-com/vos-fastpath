# vos-fastpath — OpenSIPS 3.4+ minimal config for benchmarking
# REGISTER → 200 OK (usrloc)  |  OPTIONS → 200 OK  |  INVITE → 404

mpath="/usr/lib/x86_64-linux-gnu/opensips/modules/"
socket=udp:0.0.0.0:5060
udp_workers=4
log_level=3
stderror_enabled=yes

# ----- Modules -----
loadmodule "usrloc.so"
loadmodule "registrar.so"
loadmodule "signaling.so"
loadmodule "sl.so"
loadmodule "rr.so"
loadmodule "maxfwd.so"
loadmodule "proto_udp.so"
loadmodule "textops.so"
loadmodule "sipmsgops.so"

# usrloc: in-memory only (no DB)
modparam("usrloc", "working_mode_preset", "single-instance-no-db")
modparam("usrloc", "use_domain", 0)

# registrar: default expires
modparam("registrar", "default_expires", 3600)

# ----- Main request route -----
route {
    if (!mf_process_maxfwd_header(10)) {
        send_reply(483, "Too Many Hops");
        exit;
    }
    if (is_method("REGISTER")) {
        if (!save("location")) {
            send_reply(500, "Registration failed");
            exit;
        }
        exit;
    }
    if (is_method("OPTIONS")) {
        send_reply(200, "OK");
        exit;
    }
    if (is_method("INVITE|SUBSCRIBE|NOTIFY")) {
        send_reply(404, "Not Found");
        exit;
    }
    send_reply(405, "Method Not Allowed");
}
